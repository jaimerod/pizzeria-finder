<!-- Base elements -->
<link rel="import" href="../bower_components/polymer/polymer.html" />
<link rel="import" href="../bower_components/paper-card/paper-card.html" />
<link rel="import" href="../bower_components/iron-icons/iron-icons.html" />
<link rel="import" href="pizza-reviews.html">

<dom-module id="pizza-details">
  <template>
    <style is="custom-style">
      #pizza-details { display: none; }
      #pizza-details.active { display: block; }
      .pizzaria-header { @apply(--paper-font-headline); }
      .pizzeria-light { color: var(--paper-grey-600); }
      .pizzeria-location {
        float: right;
        font-size: 15px;
        vertical-align: middle;
      }
      .pizzeria-reserve { color: var(--google-blue-500); }
      iron-icon.star {
        --iron-icon-width: 16px;
        --iron-icon-height: 16px;
        color: var(--paper-amber-500);
      }
      iron-icon.star.gray { color: var(--paper-grey-500); }
      paper-card {
        margin: 8px;
        max-width: 350px;
        margin: 0 auto;
        --paper-card-header-image: {
          height: 200px;
          background-position: center;
        }
      }
    </style>
      <paper-card id="pizza-details" class="cyan" image$="{{photo}}" fadeImage>
        <div class="card-content">
          <div class="pizzeria-header">{{name}}</div>
          <div class="pizzeria-rating">
            <iron-icon class$="{{star1}}" icon="star"></iron-icon>
            <iron-icon class$="{{star2}}" icon="star"></iron-icon>
            <iron-icon class$="{{star3}}" icon="star"></iron-icon>
            <iron-icon class$="{{star4}}" icon="star"></iron-icon>
            <iron-icon class$="{{star5}}" icon="star"></iron-icon>
          </div>
          <p>
            <template is="dom-repeat" items="{{tags}}">
              {{item}},
            </template>
          </p>
          <p class="pizzeria-light">{{address}}</p>
        </div>
        <div class="card-actions">
          <div class="horizontal justified">
            <paper-icon-button icon="icons:event"></paper-icon-button>
            <paper-button>Add review</paper-button>
          </div>
        </div>
      </paper-card>
      <pizza-reviews pizzeria={{pizzeria}}></pizza-reviews>
  </template>
  <script>
    Polymer({
      is: "pizza-details",
      properties: {
        name: {
          type: String
        },
        address: {
          type: String,
        },
        rating: {
          type: String,
          observer: '_ratingChanged'
        },
        tags: {
          type: Array,
        },
        star1: {
          type: String,
          value: "star"
        },
        star2: {
          type: String,
          value: "star"
        },
        star3: {
          type: String,
          value: "star"
        },
        star4: {
          type: String,
          value: "star"
        },
        star5: {
          type: String,
          value: "star"
        },
        photos: {
          type: Array,
          observer: '_photosChanged'
        }
      },
      ready: function () {
        this.addEventListener('updateDetails', this.updateDetails);
      },

      /**
       * Observes the name property then shows the web component
       * @return void
       */
      _ratingChanged: function(newValue, oldValue) {
        console.dir(newValue);

        var pizzaDetails = this.$$('#pizza-details');
        pizzaDetails.className = "active";

        // process stars
        this.star5 = (newValue < 4.5) ? "star gray" : "star";
        this.star4 = (newValue < 3.5) ? "star gray" : "star";
        this.star3 = (newValue < 1.5) ? "star gray" : "star";
        this.star2 = (newValue < 1.5) ? "star gray" : "star";
        this.star1 = (newValue < 0.5) ? "star gray" : "star";
      },
      _photosChanged: function (newValue, oldValue) {
        this.photo = "";
        var base = "https://maps.googleapis.com/maps/api/place/photo?";
        base = base + "photoreference=" +newValue[0].photo_reference;
        base = base + "&maxheight=200";
        base = base + "&key=AIzaSyBP6G38hX2uoNcjAHAUMQOYx1Uqv1z6PnQ"
        this.photo = base;
      }

    });
  </script>
</dom-module>